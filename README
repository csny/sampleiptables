1.この記事の目的
　saveしたiptablesの設定を晒しつつ、saveの大切さをアッピルしてみようかなーと。
　iptablesはコマンドで入れたり、直接編集したりで、ネットで軽く調べただけではなかなか所定の書き方がわからない。なかなか書き方が統一されてないのだ。この書き方以外認めないとか絶対正しいとかは言うつもりはない。ないけど、統一感とか書式にこだわるならこんな感じになるって話。
# less /etc/sysconfig/iptables
とかで見られる奴。ルールはあんまり深く考えてないので、もっとうまい作り方があるかもしれん。


2.動作環境
内向き非公開サーバ

OS
[root@centos opt]# cat /etc/redhat-release
CentOS release 6.5 (Final)
[root@centos opt]# uname -r
2.6.32-431.20.5.el6.i686

使用中のデーモン
ssh,Samba,BIND,Asterisk,FESS

ほか
iptables,SELinuxは常時起動

3.saveしたiptablesの中身

# Generated by iptables-save v1.4.7 on Sun Aug 17 20:11:29 2014
*filter
:INPUT DROP [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [8:1168]
:SYN-FLOOD-INPUT - [0:0]
-A INPUT -p icmp -j ACCEPT 
-A INPUT -i lo -j ACCEPT 
-A INPUT -p tcp -m state --state RELATED,ESTABLISHED -j ACCEPT 
-A INPUT -i eth0 -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -m state --state 
NEW -j SYN-FLOOD-INPUT 
-A INPUT -p tcp -m tcp --dport 22 --tcp-flags FIN,SYN,RST,ACK SYN -m state --state NEW -j ACCEPT 
-A INPUT -p udp -m udp --dport 137 -j ACCEPT 
-A INPUT -p udp -m udp --dport 138 -j ACCEPT 
-A INPUT -p tcp -m tcp --dport 139 --tcp-flags FIN,SYN,RST,ACK SYN -m state --state NEW -j ACCEPT 
-A INPUT -p tcp -m tcp --dport 445 --tcp-flags FIN,SYN,RST,ACK SYN -m state --state NEW -j ACCEPT 
-A INPUT -p tcp -m tcp --dport 53 --tcp-flags FIN,SYN,RST,ACK SYN -m state --state NEW -j ACCEPT 
-A INPUT -p udp -m udp --dport 53 -j ACCEPT 
-A INPUT -p tcp -m tcp --dport 8080 --tcp-flags FIN,SYN,RST,ACK SYN -m state --state NEW -j ACCEPT 
-A INPUT -p udp -m udp --dport 5060 -j ACCEPT 
-A INPUT -p udp -m udp --dport 4569 -j ACCEPT 
-A INPUT -p udp -m udp --dport 10000:20000 -j ACCEPT 
-A INPUT -j REJECT --reject-with icmp-host-prohibited 
-A INPUT -j DROP 
-A FORWARD -j REJECT --reject-with icmp-host-prohibited 
-A FORWARD -j DROP 
-A SYN-FLOOD-INPUT -m hashlimit --hashlimit-upto 5/sec --hashlimit-mode srcip,dstport --hashlimit-name SYN_FLOOD -j RETURN
-A SYN-FLOOD-INPUT -j DROP 
COMMIT
# Completed on Sun Aug 17 20:11:29 2014


4.オススメ編集手順
　iptablesの編集は、以下の手順でやると、書き方が統一されると思う。特にsaveが大事。手間だけど。

1.コマンド入力（テーブル初作成時やユーザ定義のチェインを作るときなど）
2.vi /etc/sysconfig/iptables
3.:wq
4.サービス再起動
5.service iptables save
